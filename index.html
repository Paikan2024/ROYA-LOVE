<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="theme-color" content="#061a12" />
  <title>Roya üíö‚ù§Ô∏è</title>

  <style>
    :root{
      --bgA:#03130b; --bgB:#071f14;
      --text:#eafff2; --muted:rgba(234,255,242,.72);
      --neo:#33ff99; --mint:#9bffcf; --lime:#cfff6a;
      --red:#ff4d6d; --rose:#ff7a90;
      --stroke: rgba(234,255,242,.14);
      --shadow: 0 18px 70px rgba(0,0,0,.55);
      --radius: 26px;
    }
    *{ box-sizing:border-box; -webkit-tap-highlight-color: transparent; -webkit-text-size-adjust:100%; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      background:
        radial-gradient(900px 700px at 15% 10%, rgba(51,255,153,.18), transparent 60%),
        radial-gradient(900px 700px at 85% 25%, rgba(207,255,106,.10), transparent 60%),
        radial-gradient(900px 700px at 60% 80%, rgba(155,255,207,.10), transparent 60%),
        radial-gradient(900px 700px at 75% 12%, rgba(255,77,109,.12), transparent 60%),
        linear-gradient(135deg, var(--bgA), var(--bgB));
      overflow:hidden;
    }
    .grid{
      position:fixed; inset:0;
      background-image:
        linear-gradient(rgba(234,255,242,.06) 1px, transparent 1px),
        linear-gradient(90deg, rgba(234,255,242,.06) 1px, transparent 1px);
      background-size: 44px 44px;
      opacity:.10;
      mask-image: radial-gradient(circle at 50% 20%, rgba(0,0,0,1), rgba(0,0,0,.2), transparent 75%);
      -webkit-mask-image: radial-gradient(circle at 50% 20%, rgba(0,0,0,1), rgba(0,0,0,.2), transparent 75%);
      pointer-events:none;
    }
    .aurora{
      position:fixed; inset:-40%;
      background:
        radial-gradient(circle at 20% 30%, rgba(51,255,153,.22), transparent 40%),
        radial-gradient(circle at 70% 40%, rgba(207,255,106,.14), transparent 44%),
        radial-gradient(circle at 45% 80%, rgba(155,255,207,.14), transparent 46%),
        radial-gradient(circle at 80% 20%, rgba(255,77,109,.12), transparent 45%);
      filter: blur(56px);
      animation: float 12s ease-in-out infinite alternate;
      pointer-events:none;
    }
    @keyframes float{
      from{ transform: translate3d(-1.5%, -1%, 0) scale(1); }
      to{ transform: translate3d(1.5%, 1%, 0) scale(1.05); }
    }

    .particles{ position:fixed; inset:0; pointer-events:none; }
    .p{
      position:absolute; width:6px; height:6px; border-radius:50%;
      background: radial-gradient(circle at 30% 30%, var(--lime), rgba(51,255,153,.25));
      opacity:0; animation: rise linear infinite;
      filter: drop-shadow(0 12px 18px rgba(51,255,153,.10));
    }
    .p.red{
      background: radial-gradient(circle at 30% 30%, var(--rose), rgba(255,77,109,.20));
      filter: drop-shadow(0 12px 18px rgba(255,77,109,.10));
    }
    @keyframes rise{
      from{ transform: translateY(110vh) scale(.7); opacity:0; }
      15%{ opacity:.85; }
      to{ transform: translateY(-20vh) scale(1.2); opacity:0; }
    }

    .wrap{
      height:100%;
      display:grid;
      place-items:center;
      padding:
        max(14px, env(safe-area-inset-top))
        max(14px, env(safe-area-inset-right))
        max(18px, env(safe-area-inset-bottom))
        max(14px, env(safe-area-inset-left));
      position:relative; z-index:2;
    }

    .shell{
      width:min(980px, 96vw);
      border-radius: var(--radius);
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
      border: 1px solid var(--stroke);
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
      -webkit-backdrop-filter: blur(12px);
      backdrop-filter: blur(12px);
    }
    .shell:before{
      content:"";
      position:absolute; inset:-2px;
      background:
        radial-gradient(circle at 20% 10%, rgba(51,255,153,.28), transparent 45%),
        radial-gradient(circle at 90% 35%, rgba(207,255,106,.18), transparent 55%),
        radial-gradient(circle at 85% 15%, rgba(255,77,109,.12), transparent 50%);
      opacity:.85; pointer-events:none;
    }

    .content{ position:relative; padding: 18px 16px 16px; display:grid; gap:12px; }
    .header{ display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap; align-items:center; }
    .chip{
      display:inline-flex; align-items:center; gap:10px;
      padding:10px 12px; border-radius:999px;
      background: rgba(255,255,255,.06);
      border:1px solid rgba(234,255,242,.16);
      color:rgba(234,255,242,.80);
      font-size:13px; letter-spacing:.2px;
    }
    .chip b{ color:var(--text); font-weight:900; }
    .dot{ width:8px; height:8px; border-radius:50%;
      background: linear-gradient(180deg, var(--neo), var(--mint));
      box-shadow: 0 0 18px rgba(51,255,153,.55);
    }
    .dot.red{
      background: linear-gradient(180deg, var(--red), var(--rose));
      box-shadow: 0 0 18px rgba(255,77,109,.45);
    }

    .hero{ display:grid; gap:6px; padding: 6px 2px 0; }
    .hero h1{
      margin:0; font-size: clamp(24px, 5.7vw, 46px);
      line-height:1.12; letter-spacing:-.6px;
      text-shadow: 0 10px 30px rgba(0,0,0,.45);
    }
    .hero p{ margin:0; font-size: clamp(14px, 3.7vw, 18px); line-height:1.55; color: var(--muted); max-width: 70ch; }

    .stage{
      margin-top:8px;
      border-radius: 20px;
      border:1px solid rgba(234,255,242,.12);
      background:
        radial-gradient(600px 400px at 50% 0%, rgba(51,255,153,.10), transparent 60%),
        radial-gradient(600px 400px at 80% 10%, rgba(255,77,109,.08), transparent 60%),
        rgba(255,255,255,.04);
      padding: 16px 14px;
      min-height: 440px;
      position:relative; overflow:hidden;
    }

    .panel{ width:min(760px, 100%); display:grid; gap:14px; place-items:center; text-align:center; }
    .question{ font-size: clamp(20px, 5vw, 40px); line-height:1.2; margin:0; }
    .sub{ margin:0; color: var(--muted); font-size: clamp(14px, 3.7vw, 18px); line-height:1.55; max-width: 70ch; }

    .actions{ display:flex; justify-content:center; flex-wrap:wrap; gap:12px; width:100%; margin-top:2px; }
    button{
      appearance:none; -webkit-appearance:none;
      border:none; cursor:pointer;
      border-radius: 999px;
      padding: 14px 18px;
      font-size: 16px;
      font-weight: 950;
      letter-spacing:.2px;
      min-width: 150px;
      transition: transform .12s ease, filter .12s ease, opacity .12s ease;
      box-shadow: 0 14px 34px rgba(0,0,0,.35);
      touch-action: manipulation;
    }
    button:active{ transform: translateY(1px) scale(.99); }
    .btn-main{
      background: linear-gradient(135deg, var(--neo), var(--mint));
      color: #041a10;
      filter:
        drop-shadow(0 18px 40px rgba(51,255,153,.18))
        drop-shadow(0 10px 30px rgba(255,77,109,.08));
    }
    .btn-soft{
      background: rgba(255,255,255,.06);
      border:1px solid rgba(234,255,242,.18);
      color: var(--text);
      -webkit-backdrop-filter: blur(10px);
      backdrop-filter: blur(10px);
    }
    .hint{ min-height:18px; font-size:12px; color: rgba(234,255,242,.55); letter-spacing:.2px; }

    .page{
      position:absolute; inset:0;
      display:grid; place-items:center;
      opacity:0; pointer-events:none;
      transform: translateY(10px);
      transition: opacity .5s ease, transform .5s ease;
      padding: 14px;
    }
    .page.on{ opacity:1; pointer-events:auto; transform: translateY(0); }

    .bigCard{
      width:min(720px, 96%);
      border-radius: 20px;
      background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
      border:1px solid rgba(234,255,242,.14);
      box-shadow: 0 18px 60px rgba(0,0,0,.35);
      padding: 16px 14px;
    }

    .type{ font-size: clamp(16px, 4.4vw, 24px); min-height: 3.1em; max-width: 60ch; padding: 0 4px; }
    .cursor{
      display:inline-block; width:10px; height:1.1em;
      background: rgba(234,255,242,.75);
      margin-left:6px;
      transform: translateY(3px);
      animation: blink .9s steps(2) infinite;
      border-radius:2px;
    }
    @keyframes blink{ 50%{ opacity:0; } }
    .finalText{ font-size: clamp(16px, 4.2vw, 22px); line-height:1.7; color: rgba(234,255,242,.92); margin:0; }
    .hidden{ display:none !important; }

    /* ===== FINAL ROSE OVERLAY (AUTO) ===== */
    .finalOverlay{
      position:absolute; inset:0; z-index:50;
      opacity:0; pointer-events:none;
      transition: opacity .55s ease;
    }
    .finalOverlay.on{ opacity:1; pointer-events:auto; }
    .finalOverlay::before{
      content:"";
      position:absolute; inset:0;
      background:
        radial-gradient(700px 420px at 50% 10%, rgba(255,77,109,.14), transparent 60%),
        radial-gradient(700px 420px at 55% 20%, rgba(51,255,153,.10), transparent 60%),
        rgba(0,0,0,.20);
      -webkit-backdrop-filter: blur(2px);
      backdrop-filter: blur(2px);
    }
    .finalHud{
      position:absolute; top: 12px; left: 12px; right: 12px;
      display:flex; justify-content:space-between; gap:10px;
      z-index:3;
    }
    .tag{
      display:inline-flex; align-items:center; gap:10px;
      padding:10px 12px; border-radius:999px;
      background: rgba(0,0,0,.20);
      border:1px solid rgba(234,255,242,.16);
      color: rgba(234,255,242,.88);
      font-size: 13px; letter-spacing:.2px;
      -webkit-backdrop-filter: blur(10px);
      backdrop-filter: blur(10px);
    }
    .finalArea{
      position:absolute;
      inset: 60px 12px 64px 12px;
      border-radius: 22px;
      overflow:hidden;
      border:1px solid rgba(234,255,242,.14);
      background: rgba(255,255,255,.04);
      box-shadow: 0 18px 60px rgba(0,0,0,.35);
      z-index:2;
    }
    .roseRain{ position:absolute; inset:0; z-index:1; }
    .rose{
      position:absolute; top:-60px;
      line-height:1;
      opacity:.95;
      will-change: transform;
      filter: drop-shadow(0 10px 18px rgba(0,0,0,.20));
      animation: fall linear infinite;
      user-select:none;
    }
    @keyframes fall{
      from{ transform: translate3d(0, -70px, 0) rotate(0deg); opacity:0; }
      10%{ opacity:.95; }
      to{ transform: translate3d(0, 1000px, 0) rotate(360deg); opacity:0; }
    }
    .spellMode .rose{
      animation:none !important;
      transition: transform 2.8s cubic-bezier(.2,.9,.2,1), opacity .9s ease;
      opacity: 1;
    }
    .finalHint{
      position:absolute; left: 12px; right: 12px; bottom: 12px;
      text-align:center;
      color: rgba(234,255,242,.72);
      font-size: 13px; letter-spacing:.2px;
      z-index:3;
      padding: 10px 12px;
      border-radius: 999px;
      background: rgba(0,0,0,.16);
      border:1px solid rgba(234,255,242,.12);
      -webkit-backdrop-filter: blur(10px);
      backdrop-filter: blur(10px);
    }

    @media (min-width: 760px){
      .content{ padding: 26px 24px 22px; gap:14px; }
      .stage{ min-height: 360px; padding: 22px 18px; }
      button{ min-width: 170px; }
    }
  </style>
</head>

<body>
  <div class="aurora"></div>
  <div class="grid"></div>
  <div class="particles" id="particles"></div>

  <div class="wrap">
    <div class="shell">
      <div class="content">
        <div class="header">
          <div class="chip"><span class="dot"></span> For <b>ROYA</b> ‚Ä¢ from <b>NASER</b></div>
          <div class="chip" id="status"><span class="dot red"></span> Tap ‚ÄúStart‚Äù when you‚Äôre ready üíö‚ù§Ô∏è</div>
        </div>

        <div class="hero">
          <h1>Roya‚Ä¶ I have one question.</h1>
          <p>At the end, roses will rain down and clearly spell: <b>I LOVE YOU</b> üåπ</p>
        </div>

        <div class="stage" aria-live="polite">
          <!-- PAGE 1 -->
          <div class="page on" id="page1">
            <div class="panel">
              <p class="question" id="q1">üíå</p>
              <p class="sub" id="s1">Press start ‚Äî and don‚Äôt blink.</p>

              <div class="actions">
                <button class="btn-main" id="startBtn">Start üíö</button>
                <button class="btn-soft hidden" id="yes1">Yes üíö</button>
                <button class="btn-soft hidden" id="no1">No üôà</button>
              </div>

              <div class="hint" id="hint1"></div>
            </div>
          </div>

          <!-- PAGE 2 -->
          <div class="page" id="page2">
            <div class="panel">
              <div class="bigCard">
                <p class="question">Will you be there on <b>Monday, 16 February</b>?</p>
                <p class="sub">Just say yes‚Ä¶ and I‚Äôll tell you what I‚Äôm hoping for.</p>

                <div class="actions" style="margin-top:12px;">
                  <button class="btn-main" id="yes2">Yes üíö‚ù§Ô∏è</button>
                  <button class="btn-soft" id="backBtn">Back</button>
                </div>

                <div class="hint" id="hint2"></div>
              </div>

              <div class="bigCard hidden" id="poemCard">
                <div class="type">
                  <span id="typed"></span><span class="cursor"></span>
                </div>

                <p class="finalText hidden" id="finalMsg">
                  I hope that me and you have a perfect Valentine‚Äôs Day together. üíö‚ù§Ô∏è
                </p>

                <div class="actions" style="margin-top:12px;">
                  <button class="btn-soft" id="restartBtn">Restart</button>
                </div>
              </div>
            </div>
          </div>

          <!-- FINAL ROSE OVERLAY -->
          <div class="finalOverlay" id="finalOverlay">
            <div class="finalHud">
              <div class="tag">üåπ Finale</div>
              <div class="tag" id="finalStatus">Raining roses‚Ä¶</div>
            </div>

            <div class="finalArea" id="finalArea">
              <div class="roseRain" id="roseRain"></div>
            </div>

            <div class="finalHint" id="finalHint">Wait for it‚Ä¶ üåπ</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Background particles
    const particles = document.getElementById("particles");
    function spawnParticle(){
      const d = document.createElement("div");
      const isRed = Math.random() < 0.18;
      d.className = "p" + (isRed ? " red" : "");
      d.style.left = (Math.random()*100) + "vw";
      const s = 4 + Math.random()*6;
      d.style.width = s + "px";
      d.style.height = s + "px";
      d.style.animationDuration = (6 + Math.random()*6) + "s";
      particles.appendChild(d);
      setTimeout(()=>d.remove(), 14000);
    }
    setInterval(spawnParticle, 180);
    for(let i=0;i<18;i++) setTimeout(spawnParticle, i*120);
    function burst(){ for (let i=0; i<70; i++) setTimeout(spawnParticle, i*8); }

    // Elements
    const status = document.getElementById("status");
    const page1 = document.getElementById("page1");
    const page2 = document.getElementById("page2");

    const startBtn = document.getElementById("startBtn");
    const yes1 = document.getElementById("yes1");
    const no1  = document.getElementById("no1");

    const q1 = document.getElementById("q1");
    const s1 = document.getElementById("s1");
    const hint1 = document.getElementById("hint1");

    const yes2 = document.getElementById("yes2");
    const backBtn = document.getElementById("backBtn");
    const hint2 = document.getElementById("hint2");

    const poemCard = document.getElementById("poemCard");
    const typed = document.getElementById("typed");
    const finalMsg = document.getElementById("finalMsg");
    const restartBtn = document.getElementById("restartBtn");

    const languageQuestions = [
      { lang: "FA", text: "ÿ±Ÿà€åÿß‚Ä¶ ÿ¢€åÿß ŸàŸÑŸÜÿ™ÿß€åŸÜ ŸÖŸÜ ŸÖ€å‚Äåÿ¥Ÿà€åÿü", sub: "ÿ™ŸÖÿßŸÖ ŸÇŸÑÿ®ŸÖ ÿ®ÿ±ÿß€å ÿ™Ÿàÿ≥ÿ™ üíö‚ù§Ô∏è" },
      { lang: "FR", text: "Roya‚Ä¶ veux-tu √™tre ma Valentine ?", sub: "Je t‚Äôaime plus que les mots üíö‚ù§Ô∏è" },
      { lang: "EN", text: "Roya‚Ä¶ will you be my Valentine?", sub: "My favorite person‚Ä¶ always üíö‚ù§Ô∏è" }
    ];

    const poemLines = [
      "I hope that me and you‚Ä¶",
      "have a perfect Valentine‚Äôs Day together. üíö‚ù§Ô∏è"
    ];

    function sleep(ms){ return new Promise(r => setTimeout(r, ms)); }

    function showPage(which){
      if (which === 1){
        page1.classList.add("on");
        page2.classList.remove("on");
      } else {
        page1.classList.remove("on");
        page2.classList.add("on");
      }
    }

    async function cycleLanguages(){
      startBtn.classList.add("hidden");
      status.textContent = "Don‚Äôt rush‚Ä¶ just feel it üíö‚ù§Ô∏è";
      hint1.textContent = "";

      for (const q of languageQuestions){
        q1.textContent = q.text;
        s1.textContent = q.sub;
        hint1.textContent = "Language: " + q.lang;
        await sleep(2100);
      }

      yes1.classList.remove("hidden");
      no1.classList.remove("hidden");
      q1.textContent = "üíö‚ù§Ô∏è";
      s1.textContent = "So‚Ä¶ what do you say?";
      hint1.textContent = "";
    }

    function moveNoButton(){
      const stage = document.querySelector(".stage");
      const rect = stage.getBoundingClientRect();
      const btnRect = no1.getBoundingClientRect();
      const maxX = rect.width - btnRect.width - 18;
      const maxY = rect.height - btnRect.height - 18;
      const x = 10 + Math.random() * Math.max(10, maxX);
      const y = 10 + Math.random() * Math.max(10, maxY);
      no1.style.position = "absolute";
      no1.style.left = x + "px";
      no1.style.top = y + "px";
    }

    async function typeWriter(line, speed=32){
      typed.textContent = "";
      for (let i=0; i<line.length; i++){
        typed.textContent += line[i];
        await sleep(speed);
      }
    }

    async function showPoemThenFinale(){
      poemCard.classList.remove("hidden");
      finalMsg.classList.add("hidden");
      typed.textContent = "";
      hint2.textContent = "üíö‚ù§Ô∏è";

      await typeWriter(poemLines[0], 30);
      await sleep(500);
      await typeWriter(poemLines[1], 30);
      await sleep(350);

      finalMsg.classList.remove("hidden");
      burst();

      // auto finale
      await sleep(1400);
      triggerRoseFinale();
    }

    // ===== Rose Finale (fixed for iPhone) =====
    const finalOverlay = document.getElementById("finalOverlay");
    const finalArea = document.getElementById("finalArea");
    const roseRain = document.getElementById("roseRain");
    const finalStatus = document.getElementById("finalStatus");
    const finalHint = document.getElementById("finalHint");

    let roses = [];
    let rainTimer = null;
    let finaleTimer = null;

    function clearRoses(){
      roses.forEach(r => r.remove());
      roses = [];
      roseRain.innerHTML = "";
      finalArea.classList.remove("spellMode");
      if (rainTimer) clearInterval(rainTimer);
      if (finaleTimer) clearTimeout(finaleTimer);
      rainTimer = null;
      finaleTimer = null;
    }

    function createRose(){
      const el = document.createElement("div");
      el.className = "rose";
      el.textContent = "üåπ";

      const rect = finalArea.getBoundingClientRect();
      const small = rect.width < 420;

      const left = Math.random() * 100; // vw within overlay layer (fine visually)
      const size = small ? (16 + Math.random()*14) : (18 + Math.random()*18);
      const dur  = small ? (3.8 + Math.random()*4.2) : (4 + Math.random()*4.8);
      const delay = Math.random() * 1.2;

      el.style.left = left + "vw";
      el.style.fontSize = size + "px";
      el.style.animationDuration = dur + "s";
      el.style.animationDelay = delay + "s";
      el.style.opacity = (0.75 + Math.random()*0.25).toFixed(2);

      roseRain.appendChild(el);
      roses.push(el);

      if (roses.length > 220){
        const old = roses.shift();
        old && old.remove();
      }
    }

    // Get points from canvas text (two-line for phone clarity)
    function getTextPoints(lines, w, h){
      const canvas = document.createElement("canvas");
      canvas.width = w;
      canvas.height = h;
      const ctx = canvas.getContext("2d");

      ctx.clearRect(0,0,w,h);

      const isSmall = w < 420;
      const fontSize = isSmall ? Math.floor(w / 5.2) : Math.floor(w / 6.2); // bigger on small screens
      const safeFont = Math.max(44, Math.min(92, fontSize));

      ctx.textAlign = "center";
      ctx.textBaseline = "middle";
      ctx.fillStyle = "#fff";
      ctx.font = `900 ${safeFont}px system-ui, -apple-system, Segoe UI, Roboto, Arial`;

      const lineHeight = safeFont * 1.05;
      const totalHeight = (lines.length - 1) * lineHeight;
      const startY = h/2 - totalHeight/2;

      lines.forEach((ln, i) => {
        ctx.fillText(ln, w/2, startY + i*lineHeight);
      });

      const img = ctx.getImageData(0,0,w,h).data;

      // density: tighter for small screens so letters look solid
      const gap = isSmall ? 8 : 10;

      const points = [];
      for (let y=0; y<h; y+=gap){
        for (let x=0; x<w; x+=gap){
          const idx = (y*w + x) * 4 + 3;
          if (img[idx] > 70) points.push([x,y]);
        }
      }

      // If too many points, thin them evenly to match rose count nicely
      return points;
    }

    function triggerRoseFinale(){
      finalOverlay.classList.add("on");
      finalStatus.textContent = "Raining roses‚Ä¶";
      finalHint.textContent = "Wait for it‚Ä¶ üåπ";

      clearRoses();

      for (let i=0;i<70;i++) createRose();
      rainTimer = setInterval(createRose, 120);

      finaleTimer = setTimeout(spellWithRoses, 5200);
    }

    function spellWithRoses(){
      finalStatus.textContent = "Spelling‚Ä¶";
      finalHint.textContent = "I LOVE YOU üåπ";

      if (rainTimer) { clearInterval(rainTimer); rainTimer = null; }

      while (roses.length < 210) createRose();

      finalArea.classList.add("spellMode");

      const rect = finalArea.getBoundingClientRect();
      const w = Math.floor(rect.width);
      const h = Math.floor(rect.height);

      // Two-line message => much clearer on iPhone
      const lines = ["I LOVE", "YOU"];
      let points = getTextPoints(lines, w, h);

      // Trim points to available roses (evenly)
      const max = Math.min(points.length, roses.length);
      const step = points.length / max;
      const targets = [];
      for (let i=0; i<max; i++){
        targets.push(points[Math.floor(i * step)]);
      }

      // Position roses inside finalArea using translate
      roses.forEach(r => { r.style.left = "0px"; r.style.top = "0px"; });

      // quick scatter
      roses.forEach((r) => {
        const sx = Math.random() * w;
        const sy = Math.random() * h;
        r.style.transform = `translate3d(${sx}px, ${sy}px, 0) rotate(${(Math.random()*120-60).toFixed(1)}deg)`;
      });

      setTimeout(() => {
        targets.forEach((pt, i) => {
          const r = roses[i];
          if (!r) return;
          const [x,y] = pt;
          const jitter = (Math.random()*2 - 1);
          const rot = (Math.random()*16 - 8);
          r.style.transform = `translate3d(${x + jitter}px, ${y + jitter}px, 0) rotate(${rot}deg)`;
          r.style.opacity = "1";
        });

        for (let i=targets.length; i<roses.length; i++){
          roses[i].style.opacity = "0";
          roses[i].style.transform = `translate3d(${w/2}px, ${h + 60}px, 0) rotate(0deg)`;
        }

        setTimeout(() => {
          finalStatus.textContent = "I LOVE YOU üíö‚ù§Ô∏è";
          finalHint.textContent = "Happy Valentine‚Äôs Day üåπ";
          burst();
        }, 2900);
      }, 650);
    }

    // Events
    startBtn.addEventListener("click", cycleLanguages);

    yes1.addEventListener("click", () => {
      status.textContent = "One more thing‚Ä¶ üíö‚ù§Ô∏è";
      showPage(2);
    });

    no1.addEventListener("mouseenter", moveNoButton);
    no1.addEventListener("click", moveNoButton);
    no1.addEventListener("touchstart", (e)=>{ e.preventDefault(); moveNoButton(); }, {passive:false});

    backBtn.addEventListener("click", () => {
      status.textContent = "Tap ‚ÄúStart‚Äù when you‚Äôre ready üíö‚ù§Ô∏è";
      showPage(1);
    });

    yes2.addEventListener("click", async () => {
      status.textContent = "Okay‚Ä¶ read this üíö‚ù§Ô∏è";
      await showPoemThenFinale();
    });

    restartBtn.addEventListener("click", () => restartAll());

    function restartAll(){
      finalOverlay.classList.remove("on");
      clearRoses();
      finalStatus.textContent = "Raining roses‚Ä¶";
      finalHint.textContent = "Wait for it‚Ä¶ üåπ";

      showPage(1);
      status.textContent = "Tap ‚ÄúStart‚Äù when you‚Äôre ready üíö‚ù§Ô∏è";

      startBtn.classList.remove("hidden");
      yes1.classList.add("hidden");
      no1.classList.add("hidden");
      no1.style.position = "";
      no1.style.left = "";
      no1.style.top = "";

      q1.textContent = "üíå";
      s1.textContent = "Press start ‚Äî and don‚Äôt blink.";
      hint1.textContent = "";

      poemCard.classList.add("hidden");
      typed.textContent = "";
      finalMsg.classList.add("hidden");
      hint2.textContent = "";
    }
  </script>
</body>
</html>
